<div class="container-fluid">
  <div class="row search-row-results">
    <div class="col s6 programmer-list">
      <%= render partial: 'result', collection: @results %>
    </div>
    <div class="col s6 map-houser">
      <div id="map"></div>
    </div>
  </div>
</div>

<script>
  var lat_lang_main = <%= Geocoder.coordinates(@search_city_state) %>;
  var programmers = [
                      <% @results.each do |user| %>
                        <% lat = user.lat_lang.split(/,/)[0] %>
                        <% lang = user.lat_lang.split(/,/)[1] %>
                        {
                          lat: <%= lat %>,
                          lng: <%= lang %>,
                        },
                      <% end %>
                    ];

  var markers = [];
  var map;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: {lat: lat_lang_main[0], lng: lat_lang_main[1] }
    });
  }

  function drop() {
    clearMarkers();
    for (var i = 0; i < programmers.length; i++) {
      addMarkerWithTimeout(programmers[i], i * 200);
    }
  }

  function addMarkerWithTimeout(position, timeout) {
    window.setTimeout(function() {
      markers.push(new google.maps.Marker({
        position: position,
        map: map,
        icon: '/assets/programmercopy.png',
        animation: google.maps.Animation.DROP
      }));
    }, timeout);
  }

  function clearMarkers() {
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
    }
    markers = [];
  }
  setTimeout(drop, 1000);
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBMqje86oyLLRGl_88A_f5L_e32Y7RD0Q&callback=initMap">
</script>
